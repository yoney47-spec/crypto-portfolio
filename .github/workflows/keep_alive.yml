name: Keep App Alive

on:
  schedule:
    # Run every 10 minutes for better coverage
    - cron: '*/10 * * * *'
  # Allow manual trigger from GitHub Actions tab
  workflow_dispatch:

jobs:
  ping_app:
    runs-on: ubuntu-latest
    steps:
      - name: Wake up Streamlit App
        run: |
          APP_URL="https://crypto-portfolio-fwwguaykmucufptecrrwxj.streamlit.app/"
          
          echo "üöÄ Attempting to wake up the app..."
          
          # First request - wake up the app (fetch full page, not just headers)
          HTTP_STATUS=$(curl -s -o /dev/null -w "%{http_code}" --max-time 60 "$APP_URL")
          echo "First request status: $HTTP_STATUS"
          
          # If sleeping (502/503), wait and retry
          if [ "$HTTP_STATUS" = "502" ] || [ "$HTTP_STATUS" = "503" ]; then
            echo "‚è≥ App might be sleeping, waiting 30s and retrying..."
            sleep 30
            HTTP_STATUS=$(curl -s -o /dev/null -w "%{http_code}" --max-time 120 "$APP_URL")
            echo "Retry status: $HTTP_STATUS"
          fi
          
          # Final verification
          if [ "$HTTP_STATUS" = "200" ]; then
            echo "‚úÖ App is awake and running!"
          else
            echo "‚ö†Ô∏è App returned status: $HTTP_STATUS"
          fi
